/**
 * @license
 * Copyright (c) 2015-present, Stefan Walther. All rights reserved.
 *
 * Copyrights licensed under the terms of the MIT license.
 * Original source <https://github.com/stefanwalther/sense-navigation/tree/v1.0>
 */
define(["qlik","./properties","./lib/js/helpers","text!./template.ng.html","text!./popup-editunavailable.ng.html","qvangular","css!./lib/css/main.min.css"],function(d,e,h,t,s,l){"use strict";return{definition:e,support:{export:!1,exportData:!1,snapshot:!1},initialProperties:{props:{buttonIconSet:"lui",buttonTextAlign:"center"}},snapshot:{canTakeSnapshot:!1},template:t,controller:["$scope","$element",function(p,e){if(p.doClick=function(){p.object&&1===p.object.getInteractionState()&&p.doAction().then(function(){p.doNavigate()}).catch(function(e){window.console.error(e)})},void 0===p.FirstTime){p.FirstTime=!0;var t="ontouchstart"in document.documentElement?"touchstart":"click";e.find("button").bind(t,p.doClick)}p.doNavigate=function(){switch(p.layout.props.navigationAction){case"gotoSheet":p.gotoSheet(p.layout.props.selectedSheet);break;case"gotoSheetById":p.gotoSheet(p.layout.props.sheetId);break;case"gotoStory":p.gotoStory(p.layout.props.selectedStory);break;case"firstSheet":p.firstSheet();break;case"nextSheet":p.nextSheet();break;case"openWebsite":var e=p.layout.props.websiteUrl;if(!h.isEmpty(e)){var t=p.layout.props.sameWindow,i=function(){try{return window.self!==window.top}catch(e){return!0}}(),n="";t&&i?n="_parent":t&&(n="_self"),window.open(h.fixUrl(e),n)}break;case"prevSheet":p.prevSheet();break;case"lastSheet":p.lastSheet();break;case"switchToEdit":if(d.navigation.isModeAllowed(d.navigation.EDIT)){var o=d.navigation.setMode(d.navigation.EDIT);o.success||window.console.error(o.errorMsg)}else l.getService("luiDialog").show({template:s,closeOnEscape:!0,closeOnOutside:!0})}},p.doAction=function(){if(p.layout.props&&p.layout.props.actionItems){for(var e=[],t=0;t<p.layout.props.actionItems.length;t++){var i=p.layout.props.actionItems[t].actionType,n=p.layout.qStateName,o=h.isEmpty(p.layout.props.actionItems[t].selectedField)||"by-expr"===p.layout.props.actionItems[t].selectedField?p.layout.props.actionItems[t].field:p.layout.props.actionItems[t].selectedField,s=p.layout.props.actionItems[t].value,l=p.layout.props.actionItems[t].softLock,c=p.layout.props.actionItems[t].selectedBookmark,a=p.layout.props.actionItems[t].variable,r=e.length;switch(i){case"applyBookmark":h.isEmpty(c)||e.push(p.actions.applyBookmark.bind(this,c));break;case"back":e.push(p.actions.back.bind(this));break;case"clearAll":e.push(p.actions.clearAll.bind(this,n));break;case"forward":e.push(p.actions.forward.bind(this));break;case"lockAll":e.push(p.actions.lockAll.bind(this,n));break;case"clearField":h.isEmpty(o)||e.push(p.actions.clearField.bind(this,o,n));break;case"clearOther":h.isEmpty(o)||e.push(p.actions.clearOther.bind(this,o,n,l));break;case"lockField":h.isEmpty(o)||e.push(p.actions.lockField.bind(this,o,n));break;case"unlockField":h.isEmpty(o)||e.push(p.actions.unlockField.bind(this,o,n));break;case"selectAll":h.isEmpty(o)||e.push(p.actions.selectAll.bind(this,o,n,l));break;case"selectAlternative":h.isEmpty(o)||e.push(p.actions.selectAlternative.bind(this,o,n,l));break;case"selectAndLockField":h.isEmpty(o)||h.isEmpty(s)||(e.push(p.actions.selectField.bind(this,o,n,s)),e.push(p.actions.wait.bind(null,100)),e.push(p.actions.lockField.bind(this,o,n)));break;case"selectExcluded":h.isEmpty(o)||e.push(p.actions.selectExcluded.bind(this,o,n,l));break;case"selectField":h.isEmpty(o)||h.isEmpty(s)||e.push(p.actions.selectField.bind(this,o,n,s));break;case"selectValues":h.isEmpty(o)||h.isEmpty(s)||e.push(p.actions.selectValues.bind(this,o,n,s));break;case"selectPossible":h.isEmpty(o)||e.push(p.actions.selectPossible.bind(this,o,n,l));break;case"toggleSelect":h.isEmpty(o)||h.isEmpty(s)||e.push(p.actions.toggleSelect.bind(this,o,n,s,l));break;case"setVariable":h.isEmpty(a)||e.push(p.actions.setVariableContent.bind(this,a,s));break;case"unlockAll":e.push(p.actions.unlockAll.bind(this,n));break;case"unlockAllAndClearAll":e.push(p.actions.unlockAll.bind(this,n)),e.push(p.actions.wait.bind(null,100)),e.push(p.actions.clearAll.bind(this,n))}r<e.length&&e.push(p.actions.wait.bind(null,100))}var u=d.Promise.resolve(null);return e.reduce(function(e,t){return e.then(t)},u)}},p.getEnableCond=function(e){if(e.useEnabledCondition&&0===e.enabledCondition)return!0;return!1},p.getButtonClasses=function(e){var t=[];return t.push("lui-button"),t.push("lui-button--gradient"),e.fullWidth?t.push("full-width"):t.push("auto-width"),t.join(" ")},p.getIconClasses=function(e){var t=[];switch(e.buttonIconSet){case"fa":t.push("fa"),t.push("fa-"+e.buttonIconFa);break;case"lui":t.push("lui-icon"),t.push("lui-icon--small"),t.push("lui-icon--"+e.buttonIconLui)}return t.join(" ")},p.actions={applyBookmark:function(e){return d.currApp().bookmark.apply(e)},back:function(){return d.currApp().back()},clearAll:function(e){return d.currApp().clearAll(null,e)},clearField:function(e,t){return d.currApp().field(e,t).clear()},clearOther:function(e,t,i){return d.currApp().field(e,t).clearOther(i)},forward:function(){return d.currApp().forward()},lockAll:function(e){return d.currApp().lockAll(e)},lockField:function(e,t){return d.currApp().field(e,t).lock()},selectAll:function(e,t,i){return d.currApp().field(e,t).selectAll(i)},selectAlternative:function(e,t,i){return d.currApp().field(e,t).selectAlternative(i)},selectExcluded:function(e,t,i){return d.currApp().field(e,t).selectExcluded(i)},selectField:function(e,t,i){return d.currApp().field(e,t).selectMatch(i,!1)},selectPossible:function(e,t,i){return d.currApp().field(e,t).selectPossible(i)},selectValues:function(e,t,i){var n=d.currApp(),o=h.splitToStringNum(i,";");return n.field(e,t).selectValues(o,!1)},setVariableContent:function(e,t){return d.currApp().variable.setContent(e,t)},toggleSelect:function(e,t,i,n){return d.currApp().field(e,t).toggleSelect(i,n)},unlockAll:function(e){return d.currApp().unlockAll(e)},unlockField:function(e,t){return d.currApp().field(e,t).unlock()},wait:function(e){var i=e||100;return new d.Promise(function(e){var t=setTimeout(function(){clearTimeout(t),e()},i)})}},p.navigationAction={},p.firstSheet=function(){h.getFirstSheet().then(function(e){d.navigation.gotoSheet(e.id)})},p.nextSheet=function(){d.navigation.nextSheet()},p.prevSheet=function(){d.navigation.prevSheet()},p.lastSheet=function(){h.getLastSheet().then(function(e){d.navigation.gotoSheet(e.id)})},p.gotoSheet=function(e){if(!h.isEmpty(e)){var t=d.navigation.gotoSheet(e);t.success||window.console.error(t.errorMsg)}},p.gotoStory=function(e){h.isEmpty(e)||d.navigation.gotoStory(e)}}]}});